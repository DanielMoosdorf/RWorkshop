<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Datenverarbeitung | R Workshop - Sozialwissenschaften</title>
  <meta name="description" content="Einführung in R" />
  <meta name="generator" content="bookdown 0.22.2 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Datenverarbeitung | R Workshop - Sozialwissenschaften" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Einführung in R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Datenverarbeitung | R Workshop - Sozialwissenschaften" />
  
  <meta name="twitter:description" content="Einführung in R" />
  

<meta name="author" content="Yannick Diehl und Daniel Moosdorf" />


<meta name="date" content="2021-05-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="programmiersprache-r.html"/>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Vorwort</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#voraussetzungen"><i class="fa fa-check"></i><b>0.1</b> Voraussetzungen</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#warum-r"><i class="fa fa-check"></i><b>0.2</b> Warum R?</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#was-ist-r"><i class="fa fa-check"></i><b>0.3</b> Was ist R?</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#aller-einstieg-ist-schwer"><i class="fa fa-check"></i><b>0.4</b> Aller Einstieg ist schwer?!</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#typographie"><i class="fa fa-check"></i><b>0.5</b> Typographie</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#weiterführende-literatur"><i class="fa fa-check"></i><b>0.6</b> Weiterführende Literatur</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>1</b> RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rstudio.html"><a href="rstudio.html#benutzeroberfläche"><i class="fa fa-check"></i><b>1.1</b> Benutzeroberfläche</a></li>
<li class="chapter" data-level="1.2" data-path="rstudio.html"><a href="rstudio.html#optionen"><i class="fa fa-check"></i><b>1.2</b> Optionen</a></li>
<li class="chapter" data-level="1.3" data-path="rstudio.html"><a href="rstudio.html#konsole"><i class="fa fa-check"></i><b>1.3</b> Konsole</a></li>
<li class="chapter" data-level="1.4" data-path="rstudio.html"><a href="rstudio.html#environment-und-history"><i class="fa fa-check"></i><b>1.4</b> Environment und History</a></li>
<li class="chapter" data-level="1.5" data-path="rstudio.html"><a href="rstudio.html#files"><i class="fa fa-check"></i><b>1.5</b> Files</a></li>
<li class="chapter" data-level="1.6" data-path="rstudio.html"><a href="rstudio.html#packages"><i class="fa fa-check"></i><b>1.6</b> Packages</a></li>
<li class="chapter" data-level="1.7" data-path="rstudio.html"><a href="rstudio.html#help"><i class="fa fa-check"></i><b>1.7</b> Help</a></li>
<li class="chapter" data-level="1.8" data-path="rstudio.html"><a href="rstudio.html#arbeiten-mit-rstudio"><i class="fa fa-check"></i><b>1.8</b> Arbeiten mit RStudio</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="rstudio.html"><a href="rstudio.html#projects"><i class="fa fa-check"></i><b>1.8.1</b> Projects</a></li>
<li class="chapter" data-level="1.8.2" data-path="rstudio.html"><a href="rstudio.html#konsole-oder-rscript"><i class="fa fa-check"></i><b>1.8.2</b> Konsole oder RScript?</a></li>
<li class="chapter" data-level="1.8.3" data-path="rstudio.html"><a href="rstudio.html#tab-completion"><i class="fa fa-check"></i><b>1.8.3</b> Tab completion</a></li>
<li class="chapter" data-level="1.8.4" data-path="rstudio.html"><a href="rstudio.html#nützliche-tastenbefehle-shortcuts"><i class="fa fa-check"></i><b>1.8.4</b> Nützliche Tastenbefehle (Shortcuts)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html"><i class="fa fa-check"></i><b>2</b> Programmiersprache R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#variablen-definieren"><i class="fa fa-check"></i><b>2.1</b> Variablen definieren</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#variablennamen"><i class="fa fa-check"></i><b>2.1.1</b> Variablennamen</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#funktionen-aufrufen"><i class="fa fa-check"></i><b>2.2</b> Funktionen aufrufen</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#verschachtelung-von-funktionen"><i class="fa fa-check"></i><b>2.2.1</b> Verschachtelung von Funktionen</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#objekte-und-datentypen"><i class="fa fa-check"></i><b>2.3</b> Objekte und Datentypen</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#vektoren-vector"><i class="fa fa-check"></i><b>2.3.1</b> Vektoren (vector)</a></li>
<li class="chapter" data-level="2.3.2" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#faktoren-factor"><i class="fa fa-check"></i><b>2.3.2</b> Faktoren (factor)</a></li>
<li class="chapter" data-level="2.3.3" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#datensatz-data-frame"><i class="fa fa-check"></i><b>2.3.3</b> Datensatz (data frame)</a></li>
<li class="chapter" data-level="2.3.4" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#listen-list"><i class="fa fa-check"></i><b>2.3.4</b> Listen (list)</a></li>
<li class="chapter" data-level="2.3.5" data-path="programmiersprache-r.html"><a href="programmiersprache-r.html#weitere-datentypen"><i class="fa fa-check"></i><b>2.3.5</b> Weitere Datentypen</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html"><i class="fa fa-check"></i><b>3</b> Datenverarbeitung</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#vorbereitung"><i class="fa fa-check"></i><b>3.1</b> Vorbereitung</a></li>
<li class="chapter" data-level="3.2" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#datensatz-importieren"><i class="fa fa-check"></i><b>3.2</b> Datensatz importieren</a></li>
<li class="chapter" data-level="3.3" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#transformation-und-manipulation-von-daten"><i class="fa fa-check"></i><b>3.3</b> Transformation und Manipulation von Daten</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#erster-blick-auf-den-datensatz"><i class="fa fa-check"></i><b>3.3.1</b> Erster Blick auf den Datensatz</a></li>
<li class="chapter" data-level="3.3.2" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#pipe-operator"><i class="fa fa-check"></i><b>3.3.2</b> Pipe Operator</a></li>
<li class="chapter" data-level="3.3.3" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#datensätze-restrukturieren"><i class="fa fa-check"></i><b>3.3.3</b> Datensätze restrukturieren</a></li>
<li class="chapter" data-level="3.3.4" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#daten-transformieren"><i class="fa fa-check"></i><b>3.3.4</b> Daten transformieren</a></li>
<li class="chapter" data-level="3.3.5" data-path="datenverarbeitung.html"><a href="datenverarbeitung.html#daten-manipulieren"><i class="fa fa-check"></i><b>3.3.5</b> Daten manipulieren</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Workshop - Sozialwissenschaften</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datenverarbeitung" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Datenverarbeitung</h1>
<p>In diesem Kapitel werden wir in einem ersten Schritt das Einlesen von Datensätzen in den geläufigen Datenstrurkturen kennenlernen, um in einem zweiten Schritt die Daten nach unseren Vorstellungen zu modifizieren.</p>
<p><strong>Tipp:</strong> Zur Erstellung eigener Datensätze empfehlen wir das Kapitel <a href="https://methodenlehre.github.io/einfuehrung-in-R/datensätze.html#datensätze-selber-erstellen">Datensätze selber erstellen</a> von Andrew Ellis und Boris Mayer.</p>
<div id="vorbereitung" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Vorbereitung</h2>
<p>Wir wollen mit dem Allbus-Datensatz (Allgemeine Bevölkerungsumfrage der Sozialwissenschaften) von 2018 arbeiten. Dieser lässt sich über GESIS unter: <a href="https://www.gesis.org/allbus/inhalte-suche/studienprofile-1980-bis-2018/2018">Allbus 2018</a> herunterladen.</p>
<p><strong>Anmerkung:</strong> Der Allbus 2018 ist eine standardisierte Bevölkerungsbefragung mit überproportionaler Repräsentanz von Befragten aus den neuen Bundesländern. Um diesem Umstand gerecht zu werden, müssen die Daten des Allbus gewichtet werden. Eine ideale Voraussetzung für diesen Kurs.</p>
<p>Folgend erstellen wir ein Projekt in RStudio (siehe 1.8.1). Sobald der Projektordner erstellt wurde, schieben wir unseren Datensatz in den Projektordner. Durch die Festlegung unseres Arbeitsverzeichnises im Projektordner, kann R direkt auf den Datensatz zugreifen. Der Reiter <code>Files</code> sollte entsprechend so aussehen:</p>
<p><img src="Bilder/Files2.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Abschließend erstellen wir ein RScript (siehe 1.8.2) und laden unsere Packete: tidyverse, strengejacke und easystats (siehe 1.6).</p>
<p>Voila! Nun können wir den Datensatz einlesen.</p>
</div>
<div id="datensatz-importieren" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Datensatz importieren</h2>
<p>Durch das Packet <em>sjlabelled</em> aus dem Packet <em>strengejacke</em> können wir drei verschiedene Dateiformate einlesen.</p>
<ul>
<li>.sav &gt; SPSS</li>
<li>.dta &gt; Stata</li>
<li>.sas &gt; SAS</li>
</ul>
<p>Da wir den Allbus 2018 in .sav vorliegen haben, benutzen wir die folgende Funktion.</p>
<pre><code># SPSS
allbus2018 &lt;- read_spss(&quot;ALLB2018.sav&quot;)</code></pre>
<p><strong>Wichtig!</strong> Mit der Funktion <code>read_spss()</code> über das Packet sjlabelled werden alle fehlenden Werte zu <code>NA</code> konvertiert. Sofern Sie mit fehlenden Werten arbeiten wollen, empfehlen wir das Packet <code>haven</code> über die Funktion <code>read_sav()</code> und dem Argument <code>user_na = TRUE</code> zu nutzen. Hier ist aber zu beachten, dass alle Vektoren unter der Klasse <code>labelled_spss</code> gespeichert werden. Das kann zu Problemen mit Funktionen aus externen Packeten führen. Eine Lösung wäre vorher die betreffenden Vektoren händisch in atomare Strukturen zu konvertieren (z.B. durch <code>unlabel()</code> aus sjlabelled). Zudem müssen dann alle fehlenden Werte händisch als <code>NA</code> makiert werden (<code>set_na()</code> aus sjlabelled). <em>Dazu aber später mehr!</em></p>
<p>Sollten Ihre Daten in .dta oder .sas vorliegen, können Sie die folgenden Befehle nutzen.</p>
<pre><code># Stata
allbus2018 &lt;- read_stata(&quot;Datensatz.dta&quot;)

# SAS
allbus2018 &lt;- read_sas(&quot;Datensatz.sas&quot;)</code></pre>
<p><strong>Anmerkung:</strong> Sollten Sie andere Dateiformate nutzen wollen, bieten sich zudem die Packete <code>haven</code>, <code>readxl</code> und <code>readr</code> an.</p>
<p>Die Funktion <code>read_spss</code> besitzt drei für uns relevante Argumente. Einen Überblick über die möglichen Argumente findet sich unter: <code>?read_spss</code>.</p>
<ul>
<li><code>atomic.to.fac</code> = <code>TRUE</code> &gt; Alle Variablen mit beschrifteten Ausprägungsmerkmalen werden zu Faktoren konvertiert. Für uns ist dieses Argument offensichtlich unbrauchbar, da wir viele Items vom Likert-Typ im Allbus 2018 vorfinden und diese als pseudo-metrisch behandeln wollen.</li>
<li><code>drop.labels</code> = <code>TRUE</code> &gt; Alle Ausprägungsmerkmale ohne Fälle werden gelöscht. Eine nützliche Funktion, sofern wir nicht mit fehlenden Werten arbeiten möchten. Durch <code>read_spss()</code> über das Packet sjlabelled wurden ohnehin alle vormalig fehlenden Werte zu <code>NA</code> konvertiert. So können wir die überflüssigen Ausprägungsmerkmale einfach löschen.</li>
<li><code>verbose</code> = <code>TRUE</code> &gt; Es wird beim Verarbeiten der Daten ein Fortschrittsbalken eingeblendet. Nur bei großen Datensätzen relevant.</li>
</ul>
<p>Damit empfehlen wir das Argument <code>dop.labels</code> mit <code>TRUE bzw. T</code> zu aktivieren.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="datenverarbeitung.html#cb43-1" aria-hidden="true" tabindex="-1"></a>allbus2018 <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="st">&quot;ALLB2018.sav&quot;</span>, <span class="at">drop.labels =</span> T)</span>
<span id="cb43-2"><a href="datenverarbeitung.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="datenverarbeitung.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Noch schnell den Allbus zum tibble transformieren</span></span>
<span id="cb43-4"><a href="datenverarbeitung.html#cb43-4" aria-hidden="true" tabindex="-1"></a>allbus2018 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(allbus2018)</span></code></pre></div>
<p>Hervorragend! Damit haben wir erfolgreich unsere Daten in R importiert.</p>
<p>Um bearbeitete Datensätze zu speichern, bietet sich der folgende Befehl an.</p>
<pre><code>write_spss(allbus2018, path = &quot;allbus2018&quot;)</code></pre>
<p>Die Datei wird automatisch in unserem Projektordner abgelegt. Wir können aber auch über das Argument <code>path</code> einen neuen Speicherort definieren.</p>
</div>
<div id="transformation-und-manipulation-von-daten" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Transformation und Manipulation von Daten</h2>
<p>Wie Eingangs erwähnt, arbeiten wir in diesem Kurs mit den Ökosystemen <em>tidyverse</em> und <em>strengejacke</em>, um Daten umfänglich modifizieren zu können. Natürlich gibt es auch andere Möglichkeiten der Datenbearbeitung. Wir sind aber davon überzeugt, dass die “tidyverse-Methode,” an die sich auch strengejacke anschließt, eine sehr konsistente und eingängige Form des Arbeitens ermöglicht.</p>
<p>Wie wir später noch sehen werden, erfordern viele Arten von statistischen Analysen und insbesondere Grafik-Funktionen einen Datensatz im <em>long</em>-Format. Der Allbus 2018 liegt im diesem Format vor. Dennoch muss mitunter erstaunlich viel Zeit für die Organisation von Daten für die weitere Analyse aufgewendet werden (diese Art von Arbeit wird oft als “data wrangling” bezeichnet). Sofern Sie einen Datensatz im <em>wide</em>-Format in ein <em>long</em>-Format transformieren wollen, empfehlen wir das Kapitel: <a href="https://methodenlehre.github.io/einfuehrung-in-R/daten-transformieren.html#reshaping-tidyr">Reshaping: tidyr</a> von Andrew Ellis und Boris Mayer.</p>
<div id="erster-blick-auf-den-datensatz" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Erster Blick auf den Datensatz</h3>
<p>Nachdem wir unseren Datensatz eingelesen haben, wollen wir uns zu Beginn einen Überblick über die vorhandenen Daten verschaffen.</p>
<p>Mit <code>view()</code> können wir den ganzen Datensatz als zusätzliches Fenster öffnen.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="datenverarbeitung.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(allbus2018)</span></code></pre></div>
<p>Über den Befehl <code>view_df()</code> wird uns eine HTML-Version unseres Datensatzes im <code>Viewer</code> angezeigt.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="datenverarbeitung.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_df</span>(allbus2018)</span></code></pre></div>
<p>Der große Vorteil der zweiten Abbildung liegt offensichtlich in der reduzierten Darstellung. So können wir über die Spalte <code>ID</code> ablesen, welchen Wert unsere Variablen im Spaltenvektor des Datensatzes innehaben. Wir können entsprechend Variablen über diesen indizieren. Zudem wird uns die Variablenbezeichnung über <code>Name</code>, die Variablenbeschriftung über <code>Label</code> und die Ausprägungsmerkmale bzw. Spannweite über <code>Values</code>, sowie die Merkmalsbeschriftung über <code>Value Labels</code> ausgegeben.</p>
<p>Weiterhin können wir über unsere zuvor erlernten “Grundfunktionen” einen Ausschnitt des Datensatzes generieren.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="datenverarbeitung.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ersten 3 Fälle</span></span>
<span id="cb47-2"><a href="datenverarbeitung.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(allbus2018, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb47-3"><a href="datenverarbeitung.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="datenverarbeitung.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Letzten 5 Fälle</span></span>
<span id="cb47-5"><a href="datenverarbeitung.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(allbus2018, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb47-6"><a href="datenverarbeitung.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="datenverarbeitung.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Ganzer Datensatz</span></span>
<span id="cb47-8"><a href="datenverarbeitung.html#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(allbus2018)</span></code></pre></div>
<p>Die Anwendung unserer Grundfunktionen hat gegenwärtig noch den großen Nachteil, dass R versucht alle Variablen unseres Datensatzes abzubilden. Um das in den Griff zu bekommen, wollen wir uns in den folgenden Kapiteln mit der Datensatztransformation und dann Datenmanipulation beschäftigen.</p>
</div>
<div id="pipe-operator" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Pipe Operator</h3>
<p>In Kapitel 2.2.1 konnten wir schon sehen, dass es schnell unübersichtlich werden kann, wenn wir Funktionen ineinander verschachteln. Vor allem bei der Datenverarbeitung entsteht sehr schnell unübersichtlicher Code.</p>
<p>Hierfür gibt es in R eine “ganz einfache” Lösung, da sich Sequenzen von Funktionen in <code>Pipes</code> abbilden lassen. Eine <code>Pipe</code> zeigt sich immer durch den <code>%&gt;%</code> Operator an. Um auf diesen Zugreifen zu können, müssen wir eig. das Packet <em>magrittr</em> laden. Da aber die Packete des tidyverse den Operator automatisch laden, müssen wir zumindest in seiner einfachsten Form keinen zusätzlichen Aufwand betreiben. Nun wollen wir aber mit zwei weiteren Formen des Pipe-Operators arbeiten (<code>%$%</code> und <code>%T&gt;%</code>), die uns nur über das Laden von magrittr zur Verfügung gestellt werden.</p>
<pre><code>install.packages(&quot;magrittr&quot;)
library(magrittr)</code></pre>
<p>Um schnell auf den <code>%&gt;%</code> Operator zugreifen zu können, bietet sich das Tastenkürzel <code>cmd bzw. strg</code> + <code>up</code> + <code>M</code> an.</p>
<p>Wir greifen auf unser Beispiel aus Kapitel 2.2.1 zurück. Hier wollten wir den Vektor <code>c(1.11, 1.22, 1.33, 1.44, 1.55)</code> in der Variable var1 runden. So sind wir beim letzten mal verfahren:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="datenverarbeitung.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vektor speichern in var1</span></span>
<span id="cb49-2"><a href="datenverarbeitung.html#cb49-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.11</span>, <span class="fl">1.22</span>, <span class="fl">1.33</span>, <span class="fl">1.44</span>, <span class="fl">1.55</span>)</span>
<span id="cb49-3"><a href="datenverarbeitung.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="datenverarbeitung.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden</span></span>
<span id="cb49-5"><a href="datenverarbeitung.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(var1, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb49-6"><a href="datenverarbeitung.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3 1.4 1.6</span></span></code></pre></div>
<p>In diesem Stadium ist unser Code noch sehr übersichtlich. Wir können aber auch jetzt schon eine <code>Pipe</code> bilden.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="datenverarbeitung.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vektor speichern in var1</span></span>
<span id="cb50-2"><a href="datenverarbeitung.html#cb50-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.11</span>, <span class="fl">1.22</span>, <span class="fl">1.33</span>, <span class="fl">1.44</span>, <span class="fl">1.55</span>)</span>
<span id="cb50-3"><a href="datenverarbeitung.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="datenverarbeitung.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden</span></span>
<span id="cb50-5"><a href="datenverarbeitung.html#cb50-5" aria-hidden="true" tabindex="-1"></a>var1 <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="datenverarbeitung.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb50-7"><a href="datenverarbeitung.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3 1.4 1.6</span></span></code></pre></div>
<p>Der Effekt ist für unser Beispiel klein, aber die Idee ist klar. Wir schreiben mit der <code>Pipe</code> also Funktionen nicht mehr als <code>f(x)</code> sondern als <code>x %&gt;% f() bzw. x %&gt;% f</code>.</p>
<p>Im nächsten Schritt wollen wir unseren gerundeten Vektor in eine weitere Funktion übergeben, dann wird auch der Effekt offenkundig.</p>
<p>Wir rufen zusätzlich mit <code>head()</code> die ersten drei Elemente unseres Vektors auf.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="datenverarbeitung.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vektor speichern in var1</span></span>
<span id="cb51-2"><a href="datenverarbeitung.html#cb51-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.11</span>, <span class="fl">1.22</span>, <span class="fl">1.33</span>, <span class="fl">1.44</span>, <span class="fl">1.55</span>)</span>
<span id="cb51-3"><a href="datenverarbeitung.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="datenverarbeitung.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden und die ersten drei Elemente abrufen</span></span>
<span id="cb51-5"><a href="datenverarbeitung.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">round</span>(var1, <span class="at">digits =</span> <span class="dv">1</span>), <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb51-6"><a href="datenverarbeitung.html#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3</span></span>
<span id="cb51-7"><a href="datenverarbeitung.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="datenverarbeitung.html#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden und die ersten drei Elemente abrufen in der Pipe</span></span>
<span id="cb51-9"><a href="datenverarbeitung.html#cb51-9" aria-hidden="true" tabindex="-1"></a>var1 <span class="sc">%&gt;%</span> </span>
<span id="cb51-10"><a href="datenverarbeitung.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-11"><a href="datenverarbeitung.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb51-12"><a href="datenverarbeitung.html#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3</span></span></code></pre></div>
<p>Wie wir sehen können wird der Vektor var1 durch die Funktionen “weitergegeben.” Tatsächlich gibt jede Funktion ihren Output, also ihr Ergebnis, an die nächste weiter. Im ersten Beispiel passiert das von “innen nach außen.” Damit wird es schnell unübersichtlich, zumal anstrengend zu schreiben. In der Pipe hingegen, erzeugen wir eine Übergabe von Funktion zu Funktion. In Kürze: Der Vektor aus var1 wird also an die Funktion <code>round()</code> weitergegeben und in dieser auf eine Nachkommastelle gerundet. Damit haben wir an diesem Punkt den Output: <code>c(1.1, 1.2, 1.3, 1.4, 1.6)</code>. Im nächsten Schritt wird dieser Output an <code>head()</code> übergeben. In <code>head()</code> rufen wir nur die ersten drei Elemente ab, also <code>c(1.1, 1.2, 1.3)</code>. Wir können diesen Prozess auch mit dem Platzhalter-Operator <code>.</code> veranschaulichen. Dieser steht immer für den Output aus der letzten Funktion.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="datenverarbeitung.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vektor speichern in var1</span></span>
<span id="cb52-2"><a href="datenverarbeitung.html#cb52-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.11</span>, <span class="fl">1.22</span>, <span class="fl">1.33</span>, <span class="fl">1.44</span>, <span class="fl">1.55</span>)</span>
<span id="cb52-3"><a href="datenverarbeitung.html#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="datenverarbeitung.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden und die ersten drei Elemente abrufen in der Pipe</span></span>
<span id="cb52-5"><a href="datenverarbeitung.html#cb52-5" aria-hidden="true" tabindex="-1"></a>var1 <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="datenverarbeitung.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(., <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-7"><a href="datenverarbeitung.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(., <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb52-8"><a href="datenverarbeitung.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3</span></span></code></pre></div>
<p>Ziemlich schick, nicht wahr? Der Platzhalter lässt sich aber auch an jeder anderen Stelle in der Funktion als Werthülle einsetzen.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="datenverarbeitung.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vektor speichern in var1</span></span>
<span id="cb53-2"><a href="datenverarbeitung.html#cb53-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.11</span>, <span class="fl">1.22</span>, <span class="fl">1.33</span>, <span class="fl">1.44</span>, <span class="fl">1.55</span>)</span>
<span id="cb53-3"><a href="datenverarbeitung.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="datenverarbeitung.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># var1 runden und die ersten drei Elemente abrufen in der Pipe</span></span>
<span id="cb53-5"><a href="datenverarbeitung.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="datenverarbeitung.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(var1, <span class="at">digits =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="datenverarbeitung.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb53-8"><a href="datenverarbeitung.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1 1.2 1.3</span></span></code></pre></div>
<p>Der Verkettung von Funktionen ist damit praktisch kein Limit gesetzt, außer ein paar Regeln an die man sich halten sollte.</p>
<p><code>Pipes</code> sollten nicht genutzt werden, wenn</p>
<ol style="list-style-type: decimal">
<li>die <code>Pipe</code> länger als 10 Schritte wäre,</li>
<li>mehrere Inputs oder Outputs benötigt werden,</li>
<li>eine komplexe Objektstruktur das Ziel ist.</li>
</ol>
</div>
<div id="datensätze-restrukturieren" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Datensätze restrukturieren</h3>
<p>R verspricht eine enorme Flexibilität im Umgang mit Daten. Unmittelbar spürbar wird dieser Umstand in der Reorganisation von Datensätzen in neuen Objekten. So wollen wir im ersten Schritt lernen, wie wir die für uns relevanten Daten in einem neuen Datensatz speichern können. Hierfür benötigen wir die folgende Funktionen:</p>
<table>
<thead>
<tr class="header">
<th align="left">Packet</th>
<th align="left">Funktion</th>
<th align="left">Verwendung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dplyr</td>
<td align="left">filter()</td>
<td align="left">Filtern nach Fällen mit spezifischer Ausprägung</td>
</tr>
<tr class="even">
<td align="left">dplyr</td>
<td align="left">select()</td>
<td align="left">Selektieren von Variablen</td>
</tr>
<tr class="odd">
<td align="left">dplyr</td>
<td align="left">arrange()</td>
<td align="left">Sortiert Datensatz nach bestimmter Variable</td>
</tr>
<tr class="even">
<td align="left">dplyr</td>
<td align="left">distinct()</td>
<td align="left">Auswahl einzigartiger Werte</td>
</tr>
</tbody>
</table>
</div>
<div id="daten-transformieren" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Daten transformieren</h3>
</div>
<div id="daten-manipulieren" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Daten manipulieren</h3>
<p>Zur Manipulation/Bearbeitung unseres Datensatzes werden wir maßgeblich mit dem <code>dplyr</code>-Packet aus dem tidyverse und dem Packet <code>sjmisc</code> aus <code>strengejacke</code> arbeiten. Die folgende Auswahl kann nur einen Überblick über die “wichtigsten” Funktionen dieser Packete geben. Sofern Sie weitere Tranformationswünsche haben, sollten Sie unbedingt die Entwicklerseiten dieser Packete aufsuchen und nach geeigneten Funktionen suchen (siehe 1.6).</p>
<table>
<colgroup>
<col width="27%" />
<col width="23%" />
<col width="49%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Packet</th>
<th align="left">Funktion</th>
<th align="left">Verwendung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dplyr</td>
<td align="left">rename()</td>
<td align="left">Umbenennen von Variablen</td>
</tr>
<tr class="even">
<td align="left">dplyr</td>
<td align="left">mutate()</td>
<td align="left">Erstellen und verändern von vorhandenen Variablen</td>
</tr>
<tr class="odd">
<td align="left">dplyr</td>
<td align="left">group_by()</td>
<td align="left">Erstellt Gruppen (Teilmengen)</td>
</tr>
<tr class="even">
<td align="left">dplyr</td>
<td align="left">summarize()</td>
<td align="left">Daten zusammenfassen</td>
</tr>
<tr class="odd">
<td align="left">dplyr</td>
<td align="left">case_when()</td>
<td align="left">Vektorisierter if-Befehl</td>
</tr>
<tr class="even">
<td align="left">sjmisc</td>
<td align="left">rec()</td>
<td align="left">Rekodierung von Variablen</td>
</tr>
<tr class="odd">
<td align="left">sjmisc</td>
<td align="left">std()</td>
<td align="left">Z-Standardisierung von Variablen</td>
</tr>
<tr class="even">
<td align="left">sjmisc</td>
<td align="left">center()</td>
<td align="left">Zentrierung von Variablen am Mittelwert</td>
</tr>
<tr class="odd">
<td align="left">sjmisc</td>
<td align="left">split_var()</td>
<td align="left">Aufspaltung von Variablen in n Gruppen</td>
</tr>
<tr class="even">
<td align="left">sjmisc</td>
<td align="left">group_var()</td>
<td align="left">Aufspaltung von Variablen in Gruppen gleicher Spannweite</td>
</tr>
<tr class="odd">
<td align="left">sjmisc</td>
<td align="left">row_count()</td>
<td align="left">Zählung von Zeilenwerten</td>
</tr>
<tr class="even">
<td align="left">sjmisc</td>
<td align="left">col_count()</td>
<td align="left">Zählung von Spaltenweten</td>
</tr>
<tr class="odd">
<td align="left">sjmisc</td>
<td align="left">row_sums()</td>
<td align="left">Summe der Zeilenwerte</td>
</tr>
<tr class="even">
<td align="left">sjmisc</td>
<td align="left">row_means()</td>
<td align="left">Mittelwert der Zeilenwerte</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="programmiersprache-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
